openapi: 3.0.3
info:
  title: APSæ™ºæ…§æ’äº§ç³»ç»ŸAPI - æœˆè®¡åˆ’åŠŸèƒ½
  description: |
    APS (Advanced Planning and Scheduling) æ™ºæ…§æ’äº§ç³»ç»ŸAPIè§„èŒƒ - æœˆè®¡åˆ’æ‰©å±•åŠŸèƒ½
    
    **ğŸ”¥ é‡è¦ï¼šå†²çªé¿å…è®¾è®¡**
    ä¸ºé¿å…ä¸ç°æœ‰æ—¬è®¡åˆ’(`/plans`)æ¥å£å†²çªï¼Œæœˆè®¡åˆ’åŠŸèƒ½é‡‡ç”¨ç‹¬ç«‹çš„è·¯ç”±å‰ç¼€ï¼š
    - æœˆè®¡åˆ’æ¥å£ï¼š`/monthly-plans`
    - æœˆåº¦æ’äº§ï¼š`/monthly-scheduling` 
    - æœˆåº¦å·¥å•ï¼š`/monthly-work-orders`
    
    ä¸“ä¸ºçƒŸè‰åˆ¶é€ ä¸šè®¾è®¡çš„æœˆåº¦ç”Ÿäº§è®¡åˆ’æ’äº§ç³»ç»Ÿï¼Œæ”¯æŒï¼š
    - æœˆè®¡åˆ’Excelæ–‡ä»¶ä¸Šä¼ ä¸è§£æï¼ˆæµ™æ±Ÿä¸­çƒŸ2019å¹´7æœˆä»½æ ¼å¼ï¼‰
    - æ­å·å‚æ•°æ®æå–ä¸éªŒè¯
    - æ™ºèƒ½æœˆåº¦æ’äº§ç®—æ³•æ‰§è¡Œ
    - æ’äº§ç»“æœæŸ¥è¯¢ï¼ˆè¡¨æ ¼/ç”˜ç‰¹å›¾ï¼‰
    - å·¥ä½œæ—¥å†ç®¡ç†
    - ä¸ç°æœ‰æ—¬è®¡åˆ’ç³»ç»Ÿå®Œå…¨ç‹¬ç«‹
    
    **æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼š**
    1. ä¸Šä¼ æœˆè®¡åˆ’Excel â†’ 2. è§£ææå–æ­å·å‚æ•°æ® â†’ 3. æ‰§è¡Œæœˆåº¦æ’äº§ç®—æ³• â†’ 4. æŸ¥è¯¢æ’äº§ç»“æœ
    
    **æ•°æ®æ ¼å¼ï¼š**
    - æ‰€æœ‰æ—¶é—´å­—æ®µä½¿ç”¨ISO 8601æ ¼å¼
    - æ‰€æœ‰å“åº”ä½¿ç”¨æ ‡å‡†JSONæ ¼å¼
    - æ”¯æŒä¸­æ–‡ä¸šåŠ¡æœ¯è¯­
  version: 1.0.0
  contact:
    name: APSå¼€å‘å›¢é˜Ÿ
    email: aps-support@company.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://10.0.0.87:8000/api/v1
    description: å¼€å‘ç¯å¢ƒ
  - url: https://aps-api.company.com/api/v1
    description: ç”Ÿäº§ç¯å¢ƒ

tags:
  - name: æœˆè®¡åˆ’æ–‡ä»¶ç®¡ç†
    description: æœˆè®¡åˆ’Excelæ–‡ä»¶ä¸Šä¼ ã€è§£æã€çŠ¶æ€ç®¡ç†
  - name: æœˆåº¦æ’äº§ç®—æ³•ç®¡ç†
    description: æœˆåº¦æ’äº§ç®—æ³•æ‰§è¡Œã€ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢
  - name: æœˆåº¦å·¥å•ç®¡ç†
    description: æœˆåº¦å·¥å•æŸ¥è¯¢ã€ç”˜ç‰¹å›¾æ•°æ®
  - name: æœˆåº¦æ•°æ®æŸ¥è¯¢
    description: æœˆåº¦åŸºç¡€æ•°æ®æŸ¥è¯¢ã€ç»Ÿè®¡ä¿¡æ¯
  - name: å·¥ä½œæ—¥å†ç®¡ç†
    description: å·¥ä½œæ—¥å†é…ç½®ã€èŠ‚å‡æ—¥ç®¡ç†

paths:
  # ==================== æœˆè®¡åˆ’æ–‡ä»¶ç®¡ç† ====================
  /monthly-plans/upload:
    post:
      tags:
        - æœˆè®¡åˆ’æ–‡ä»¶ç®¡ç†
      summary: ä¸Šä¼ æœˆè®¡åˆ’Excelæ–‡ä»¶
      description: |
        ä¸Šä¼ æœˆè®¡åˆ’Excelæ–‡ä»¶ï¼Œä¸“é—¨å¤„ç†æµ™æ±Ÿä¸­çƒŸæœˆåº¦ç”Ÿäº§è®¡åˆ’æ ¼å¼
        
        **æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼š** .xlsx, .xls  
        **æœ€å¤§æ–‡ä»¶å¤§å°ï¼š** 50MB  
        **æ–‡ä»¶åå”¯ä¸€æ€§ï¼š** å¯é€‰æ‹©è¦†ç›–å·²å­˜åœ¨çš„åŒåæ–‡ä»¶
        **å¤„ç†èŒƒå›´ï¼š** ä»…å¤„ç†æ­å·å‚æ•°æ®ï¼Œå¿½ç•¥å®æ³¢å‚
      operationId: uploadMonthlyPlanFile
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Excelæ–‡ä»¶
                allow_overwrite:
                  type: boolean
                  default: false
                  description: æ˜¯å¦å…è®¸è¦†ç›–å·²å­˜åœ¨çš„åŒåæ–‡ä»¶
              required:
                - file
      responses:
        '200':
          description: æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileUploadResponse'
              example:
                code: 200
                message: "æœˆè®¡åˆ’æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"
                timestamp: "2024-10-16T15:30:00Z"
                status: "success"
                data:
                  import_batch_id: "MONTHLY_20241016_153000_a1b2c3d4"
                  file_name: "æµ™æ±Ÿä¸­çƒŸ2019å¹´7æœˆä»½ç”Ÿäº§è®¡åˆ’å®‰æ’è¡¨.xlsx"
                  file_size: 2048576
                  upload_time: "2024-10-16T15:30:00Z"
                  plan_type: "monthly"
        '400':
          $ref: '#/components/responses/BadRequest'
        '413':
          description: æ–‡ä»¶è¿‡å¤§
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /monthly-plans/{import_batch_id}/parse:
    post:
      tags:
        - æœˆè®¡åˆ’æ–‡ä»¶ç®¡ç†
      summary: è§£ææœˆè®¡åˆ’Excelæå–æ­å·å‚æ•°æ®
      description: |
        è§£æä¸Šä¼ çš„æœˆè®¡åˆ’Excelæ–‡ä»¶ï¼Œä¸“é—¨æå–æ­å·å‚ç›¸å…³çš„ç”Ÿäº§è®¡åˆ’æ•°æ®
        
        **è§£æåŠŸèƒ½ï¼š**
        - è¯†åˆ«åˆå¹¶å•å…ƒæ ¼ä¸­çš„æœºå°åˆ†é…
        - æå–äº§å“ä¿¡æ¯ï¼ˆå“ç‰Œè§„æ ¼+åŸè®¡åˆ’ç›®æ ‡ç®±æ•°ï¼‰
        - è§£ææ—¶é—´èŒƒå›´å’Œç”Ÿäº§æ•°é‡
        - è¿‡æ»¤æ­å·å‚æ•°æ®ï¼Œå¿½ç•¥å®æ³¢å‚
        - éªŒè¯æ•°æ®å®Œæ•´æ€§å’Œåˆè§„æ€§
      operationId: parseMonthlyPlanFile
      parameters:
        - name: import_batch_id
          in: path
          required: true
          schema:
            type: string
          description: å¯¼å…¥æ‰¹æ¬¡ID
        - name: force_reparse
          in: query
          schema:
            type: boolean
            default: false
          description: æ˜¯å¦å¼ºåˆ¶é‡æ–°è§£æ
      responses:
        '200':
          description: è§£ææˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonthlyParseResponse'
              example:
                code: 200
                message: "æœˆè®¡åˆ’æ–‡ä»¶è§£ææˆåŠŸ"
                timestamp: "2024-10-16T15:35:00Z"
                status: "success"
                data:
                  import_batch_id: "MONTHLY_20241016_153000_a1b2c3d4"
                  total_records: 85
                  valid_records: 80
                  error_records: 5
                  hangzhou_records: 80
                  ningbo_records: 0
                  records:
                    - row_number: 5
                      brand_specification: "ä¸­åï¼ˆè½¯ï¼‰84mmæ¡ç›’"
                      target_quantity_boxes: 5000
                      machine_assignments: ["C1", "C2", "15", "16"]
                      production_month: "2019-07"
                      factory: "æ­å·"
                      validation_status: "VALID"
                  errors: []
                  warnings: []
                  parse_time: "2024-10-16T15:35:00Z"
        '202':
          description: è§£æè¿›è¡Œä¸­
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /monthly-plans/{import_batch_id}/status:
    get:
      tags:
        - æœˆè®¡åˆ’æ–‡ä»¶ç®¡ç†
      summary: æŸ¥è¯¢æœˆè®¡åˆ’æ–‡ä»¶è§£æçŠ¶æ€
      description: æŸ¥è¯¢æœˆè®¡åˆ’Excelæ–‡ä»¶çš„è§£æè¿›åº¦å’ŒçŠ¶æ€ä¿¡æ¯
      operationId: getMonthlyParseStatus
      parameters:
        - name: import_batch_id
          in: path
          required: true
          schema:
            type: string
          description: å¯¼å…¥æ‰¹æ¬¡ID
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/MonthlyPlanStatus'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /monthly-plans/{import_batch_id}/plans:
    get:
      tags:
        - æœˆè®¡åˆ’æ–‡ä»¶ç®¡ç†
      summary: æŸ¥è¯¢æœˆè®¡åˆ’è®°å½•
      description: æŸ¥è¯¢è§£æåçš„æœˆè®¡åˆ’è¯¦ç»†è®°å½•ï¼Œç”¨äºæ•°æ®éªŒè¯å’Œç¡®è®¤
      operationId: getMonthlyPlans
      parameters:
        - name: import_batch_id
          in: path
          required: true
          schema:
            type: string
          description: å¯¼å…¥æ‰¹æ¬¡ID
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          import_batch_id:
                            type: string
                          total_plans:
                            type: integer
                          plans:
                            type: array
                            items:
                              $ref: '#/components/schemas/MonthlyPlanRecord'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /monthly-plans/history:
    get:
      tags:
        - æœˆè®¡åˆ’æ–‡ä»¶ç®¡ç†
      summary: è·å–æœˆè®¡åˆ’æ–‡ä»¶ä¸Šä¼ å†å²è®°å½•
      description: |
        è·å–æœˆè®¡åˆ’æ–‡ä»¶ä¸Šä¼ å†å²è®°å½•ï¼Œæ”¯æŒåˆ†é¡µå’Œè¿‡æ»¤
        
        **åŒ…å«æœˆåº¦æ’äº§çŠ¶æ€ä¿¡æ¯ï¼š**
        - unscheduled: æœªæ’äº§
        - scheduling: æ’äº§ä¸­
        - completed: æ’äº§å®Œæˆ
        - failed: æ’äº§å¤±è´¥
      operationId: getMonthlyUploadHistory
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: é¡µç 
        - name: page_size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: æ¯é¡µå¤§å°
        - name: status
          in: query
          schema:
            type: string
            enum: [UPLOADING, PARSING, COMPLETED, FAILED]
          description: è¿‡æ»¤çŠ¶æ€
        - name: scheduling_status
          in: query
          schema:
            type: string
            enum: [unscheduled, scheduling, completed, failed]
          description: æœˆåº¦æ’äº§çŠ¶æ€è¿‡æ»¤
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          records:
                            type: array
                            items:
                              $ref: '#/components/schemas/MonthlyPlanHistoryRecord'
                          pagination:
                            $ref: '#/components/schemas/PaginationInfo'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /monthly-plans/available-for-scheduling:
    get:
      tags:
        - æœˆè®¡åˆ’æ–‡ä»¶ç®¡ç†
      summary: è·å–å¯æœˆåº¦æ’äº§çš„æ‰¹æ¬¡åˆ—è¡¨
      description: è·å–å·²å®Œæˆè§£æä½†å°šæœªè¿›è¡Œæœˆåº¦æ’äº§çš„æ‰¹æ¬¡åˆ—è¡¨
      operationId: getAvailableMonthlyBatchesForScheduling
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          available_batches:
                            type: array
                            items:
                              $ref: '#/components/schemas/AvailableMonthlyBatch'
                          total_count:
                            type: integer
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== æœˆåº¦æ’äº§ç®—æ³•ç®¡ç† ====================
  /monthly-scheduling/execute:
    post:
      tags:
        - æœˆåº¦æ’äº§ç®—æ³•ç®¡ç†
      summary: æ‰§è¡Œæœˆåº¦æ™ºèƒ½æ’äº§ç®—æ³•
      description: |
        å¯¹æŒ‡å®šæ‰¹æ¬¡çš„æœˆè®¡åˆ’æ•°æ®æ‰§è¡Œæœˆåº¦æ™ºèƒ½æ’äº§ç®—æ³•
        
        **æœˆåº¦ç®—æ³•åŠŸèƒ½ï¼š**
        - æœºå°é€‰æ‹©ç®—æ³•ï¼šåŸºäºaps_machine_speedè¡¨é€‰æ‹©æœ€ä¼˜æœºå°
        - æ—¶é—´è®¡ç®—ç®—æ³•ï¼šæ ¹æ®é€Ÿåº¦å’Œæ•ˆç‡è®¡ç®—ç”Ÿäº§æ—¶é—´
        - å·¥ä½œæ—¥å†ç®—æ³•ï¼šè€ƒè™‘èŠ‚å‡æ—¥å’Œå·¥ä½œæ—¥çº¦æŸ
        - ç»´æŠ¤çª—å£ç®—æ³•ï¼šé¿å¼€ç»´æŠ¤è®¡åˆ’æ—¶é—´æ®µ
        - ç­æ¬¡çº¦æŸç®—æ³•ï¼šéµå®ˆç­æ¬¡æ—¶é—´é™åˆ¶
        - å®¹é‡å¹³è¡¡ç®—æ³•ï¼šå‡è¡¡æœºå°è´Ÿè½½
        - æ—¶é—´åˆ†é…ç®—æ³•ï¼šä¼˜åŒ–æ—¶é—´çª—å£åˆ†é…
        - çº¦æŸæ±‚è§£ç®—æ³•ï¼šæ»¡è¶³å¤šé‡çº¦æŸæ¡ä»¶
        - è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šæœ€å°åŒ–æœºå°ç©ºé—²æ—¶é—´
      operationId: executeMonthlySchedulingAlgorithm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MonthlySchedulingRequest'
            example:
              import_batch_id: "MONTHLY_20241016_153000_a1b2c3d4"
              algorithm_config:
                efficiency_rate: 0.85
                maintenance_buffer_minutes: 30
                work_calendar_enabled: true
                shift_constraint_enabled: true
                load_balancing_enabled: true
      responses:
        '200':
          description: æœˆåº¦æ’äº§ä»»åŠ¡åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/MonthlySchedulingTaskInfo'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /monthly-scheduling/tasks:
    get:
      tags:
        - æœˆåº¦æ’äº§ç®—æ³•ç®¡ç†
      summary: æŸ¥è¯¢æœˆåº¦æ’äº§ä»»åŠ¡å†å²è®°å½•
      description: |
        æ”¯æŒå¤šç»´åº¦ç­›é€‰çš„æœˆåº¦æ’äº§ä»»åŠ¡å†å²æŸ¥è¯¢
        
        **æ”¯æŒçš„çŠ¶æ€ï¼š**
        - PENDING: ç­‰å¾…æ‰§è¡Œ
        - RUNNING: æ‰§è¡Œä¸­
        - COMPLETED: æ‰§è¡Œå®Œæˆ
        - FAILED: æ‰§è¡Œå¤±è´¥
        - CANCELLED: å·²å–æ¶ˆ
      operationId: getMonthlySchedulingTasks
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED]
          description: ä»»åŠ¡çŠ¶æ€è¿‡æ»¤
        - name: import_batch_id
          in: query
          schema:
            type: string
          description: å¯¼å…¥æ‰¹æ¬¡IDè¿‡æ»¤
        - name: start_date
          in: query
          schema:
            type: string
            format: date-time
          description: å¼€å§‹æ—¥æœŸè¿‡æ»¤
        - name: end_date
          in: query
          schema:
            type: string
            format: date-time
          description: ç»“æŸæ—¥æœŸè¿‡æ»¤
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: é¡µç 
        - name: page_size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: æ¯é¡µå¤§å°
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          tasks:
                            type: array
                            items:
                              $ref: '#/components/schemas/MonthlySchedulingTaskRecord'
                          pagination:
                            $ref: '#/components/schemas/PaginationInfo'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /monthly-scheduling/tasks/{task_id}:
    get:
      tags:
        - æœˆåº¦æ’äº§ç®—æ³•ç®¡ç†
      summary: è·å–æœˆåº¦æ’äº§ä»»åŠ¡è¯¦æƒ…
      description: |
        è·å–æœˆåº¦æ’äº§ä»»åŠ¡çš„å®Œæ•´è¯¦æƒ…ï¼ŒåŒ…æ‹¬ï¼š
        - ä»»åŠ¡åŸºæœ¬ä¿¡æ¯å’Œæ‰§è¡ŒçŠ¶æ€
        - æœˆåº¦ç®—æ³•é…ç½®å‚æ•°
        - æ‰§è¡Œæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
        - å·¥å•ç”Ÿæˆç»Ÿè®¡
      operationId: getMonthlySchedulingTaskDetail
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
          description: æœˆåº¦æ’äº§ä»»åŠ¡ID
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          task:
                            $ref: '#/components/schemas/MonthlySchedulingTaskDetail'
                          logs:
                            type: array
                            items:
                              $ref: '#/components/schemas/ProcessingLog'
                          logs_count:
                            type: integer
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /monthly-scheduling/tasks/{task_id}/status:
    get:
      tags:
        - æœˆåº¦æ’äº§ç®—æ³•ç®¡ç†
      summary: æŸ¥è¯¢æœˆåº¦æ’äº§ä»»åŠ¡çŠ¶æ€
      description: å®æ—¶æŸ¥è¯¢æœˆåº¦æ’äº§ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€å’Œè¿›åº¦ä¿¡æ¯
      operationId: getMonthlySchedulingTaskStatus
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
          description: æœˆåº¦æ’äº§ä»»åŠ¡ID
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/MonthlySchedulingTaskStatus'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== æœˆåº¦å·¥å•ç®¡ç† ====================
  /monthly-work-orders:
    get:
      tags:
        - æœˆåº¦å·¥å•ç®¡ç†
      summary: æŸ¥è¯¢æœˆåº¦æ’äº§ç”Ÿæˆçš„å·¥å•åˆ—è¡¨
      description: |
        æŸ¥è¯¢æœˆåº¦æ’äº§ç®—æ³•ç”Ÿæˆçš„å·¥å•åˆ—è¡¨ï¼Œæ”¯æŒå¤šç»´åº¦è¿‡æ»¤
        
        **æœˆåº¦å·¥å•ç±»å‹ï¼š**
        - HJB: å·åŒ…æœºå·¥å•
        - HWS: å–‚ä¸æœºå·¥å•
        - åè°ƒå·¥å•: åŒ…å«ä¸¤ç§æœºå°çš„åŒæ­¥æ’äº§å·¥å•
      operationId: getMonthlyWorkOrders
      parameters:
        - name: task_id
          in: query
          schema:
            type: string
          description: æœˆåº¦æ’äº§ä»»åŠ¡IDè¿‡æ»¤
        - name: import_batch_id
          in: query
          schema:
            type: string
          description: å¯¼å…¥æ‰¹æ¬¡IDè¿‡æ»¤
        - name: order_type
          in: query
          schema:
            type: string
            enum: [HJB, HWS]
          description: å·¥å•ç±»å‹è¿‡æ»¤
        - name: status
          in: query
          schema:
            type: string
            enum: [PLANNED, RUNNING, COMPLETED, PAUSED, CANCELLED]
          description: å·¥å•çŠ¶æ€è¿‡æ»¤
        - name: machine_code
          in: query
          schema:
            type: string
          description: æœºå°ä»£ç è¿‡æ»¤
        - name: product_code
          in: query
          schema:
            type: string
          description: äº§å“ä»£ç è¿‡æ»¤
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: é¡µç 
        - name: page_size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 2000
            default: 100
          description: æ¯é¡µå¤§å°
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          work_orders:
                            type: array
                            items:
                              $ref: '#/components/schemas/MonthlyWorkOrder'
                          total_count:
                            type: integer
                          page:
                            type: integer
                          page_size:
                            type: integer
        '500':
          $ref: '#/components/responses/InternalServerError'

  /monthly-work-orders/schedule:
    get:
      tags:
        - æœˆåº¦å·¥å•ç®¡ç†
      summary: è·å–æœˆåº¦å·¥å•æ’ç¨‹æ•°æ®ï¼ˆç”˜ç‰¹å›¾ä¸“ç”¨ï¼‰
      description: |
        ä¸“ä¸ºæœˆåº¦ç”˜ç‰¹å›¾æ˜¾ç¤ºä¼˜åŒ–çš„å·¥å•æ’ç¨‹æ•°æ®æ¥å£
        
        **æœˆåº¦ç”˜ç‰¹å›¾æ ¼å¼ï¼š**
        - work_order_nr: M0001, M0002, M0003
        - æ—¶é—´èŒƒå›´ï¼šplanned_start ~ planned_end
        - æœºå°å…³ç³»ï¼šmaker_code + feeder_code
        - åŒæ­¥ç»„ï¼šsync_group_idæ ‡è¯†åè°ƒå·¥å•
      operationId: getMonthlyWorkOrderSchedule
      parameters:
        - name: task_id
          in: query
          schema:
            type: string
          description: æœˆåº¦æ’äº§ä»»åŠ¡IDè¿‡æ»¤
        - name: work_order_nr
          in: query
          schema:
            type: string
          description: å·¥å•å·è¿‡æ»¤
        - name: machine_code
          in: query
          schema:
            type: string
          description: æœºå°ä»£ç è¿‡æ»¤
        - name: article_nr
          in: query
          schema:
            type: string
          description: äº§å“ä»£ç è¿‡æ»¤
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: é¡µç 
        - name: page_size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 2000
            default: 100
          description: æ¯é¡µå¤§å°
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          schedules:
                            type: array
                            items:
                              $ref: '#/components/schemas/MonthlyWorkOrderSchedule'
                          total_count:
                            type: integer
                          page:
                            type: integer
                          page_size:
                            type: integer
                          total_pages:
                            type: integer
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== å·¥ä½œæ—¥å†ç®¡ç† ====================
  /work-calendar:
    get:
      tags:
        - å·¥ä½œæ—¥å†ç®¡ç†
      summary: æŸ¥è¯¢å·¥ä½œæ—¥å†é…ç½®
      description: |
        æŸ¥è¯¢å·¥ä½œæ—¥å†é…ç½®ï¼ŒåŒ…æ‹¬å·¥ä½œæ—¥ã€èŠ‚å‡æ—¥ã€ç­æ¬¡ä¿¡æ¯
        
        **æ—¥å†ç±»å‹ï¼š**
        - WORKDAY: å·¥ä½œæ—¥
        - HOLIDAY: èŠ‚å‡æ—¥
        - WEEKEND: å‘¨æœ«
      operationId: getWorkCalendar
      parameters:
        - name: start_date
          in: query
          required: true
          schema:
            type: string
            format: date
          description: å¼€å§‹æ—¥æœŸ
        - name: end_date
          in: query
          required: true
          schema:
            type: string
            format: date
          description: ç»“æŸæ—¥æœŸ
        - name: calendar_type
          in: query
          schema:
            type: string
            enum: [WORKDAY, HOLIDAY, WEEKEND]
          description: æ—¥å†ç±»å‹è¿‡æ»¤
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          calendar_entries:
                            type: array
                            items:
                              $ref: '#/components/schemas/WorkCalendarEntry'
                          total_count:
                            type: integer
                          work_days:
                            type: integer
                          holidays:
                            type: integer
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - å·¥ä½œæ—¥å†ç®¡ç†
      summary: åˆ›å»ºå·¥ä½œæ—¥å†é…ç½®
      description: åˆ›å»ºæ–°çš„å·¥ä½œæ—¥å†é…ç½®é¡¹
      operationId: createWorkCalendar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkCalendarRequest'
      responses:
        '200':
          description: å·¥ä½œæ—¥å†åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== æœˆåº¦æ•°æ®æŸ¥è¯¢ ====================
  /monthly-data/statistics:
    get:
      tags:
        - æœˆåº¦æ•°æ®æŸ¥è¯¢
      summary: è·å–æœˆåº¦ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯
      description: |
        è·å–æœˆåº¦ç³»ç»Ÿæ•´ä½“ç»Ÿè®¡ä¿¡æ¯
        
        **ç»Ÿè®¡ç»´åº¦ï¼š**
        - æœˆåº¦å¯¼å…¥è®¡åˆ’ç»Ÿè®¡ï¼ˆæŒ‰çŠ¶æ€åˆ†ç»„ï¼‰
        - æœˆåº¦æ’äº§ä»»åŠ¡ç»Ÿè®¡
        - æœˆåº¦å·¥å•ç»Ÿè®¡
      operationId: getMonthlySystemStatistics
      responses:
        '200':
          description: ç»Ÿè®¡ä¿¡æ¯æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/MonthlySystemStatistics'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  schemas:
    # ==================== åŸºç¡€å“åº”æ¨¡å‹ ====================
    BaseResponse:
      type: object
      properties:
        code:
          type: integer
          description: å“åº”ä»£ç 
        message:
          type: string
          description: å“åº”æ¶ˆæ¯
        timestamp:
          type: string
          format: date-time
          description: å“åº”æ—¶é—´
      required:
        - code
        - message
        - timestamp

    SuccessResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            status:
              type: string
              enum: [success]
              default: success
            data:
              type: object
              description: å“åº”æ•°æ®

    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            status:
              type: string
              enum: [error]
              default: error
            error_details:
              type: object
              description: é”™è¯¯è¯¦æƒ…

    # ==================== åˆ†é¡µç›¸å…³æ¨¡å‹ ====================
    PaginationInfo:
      type: object
      properties:
        page:
          type: integer
          description: å½“å‰é¡µç 
        page_size:
          type: integer
          description: æ¯é¡µå¤§å°
        total_count:
          type: integer
          description: æ€»è®°å½•æ•°
        total_pages:
          type: integer
          description: æ€»é¡µæ•°
        has_next:
          type: boolean
          description: æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
        has_prev:
          type: boolean
          description: æ˜¯å¦æœ‰ä¸Šä¸€é¡µ

    # ==================== æœˆè®¡åˆ’æ–‡ä»¶ä¸Šä¼ ç›¸å…³æ¨¡å‹ ====================
    MonthlyImportBatchInfo:
      type: object
      properties:
        import_batch_id:
          type: string
          description: å¯¼å…¥æ‰¹æ¬¡ID
        file_name:
          type: string
          description: æ–‡ä»¶å
        file_size:
          type: integer
          description: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
        total_records:
          type: integer
          default: 0
          description: æ€»è®°å½•æ•°
        upload_time:
          type: string
          format: date-time
          description: ä¸Šä¼ æ—¶é—´
        plan_type:
          type: string
          enum: [monthly]
          default: monthly
          description: è®¡åˆ’ç±»å‹

    FileUploadResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/MonthlyImportBatchInfo'

    MonthlyPlanStatus:
      type: object
      properties:
        import_batch_id:
          type: string
          description: å¯¼å…¥æ‰¹æ¬¡ID
        file_name:
          type: string
          description: æ–‡ä»¶å
        import_status:
          type: string
          enum: [UPLOADING, PARSING, COMPLETED, FAILED]
          description: å¯¼å…¥çŠ¶æ€
        total_records:
          type: integer
          description: æ€»è®°å½•æ•°
        valid_records:
          type: integer
          description: æœ‰æ•ˆè®°å½•æ•°
        error_records:
          type: integer
          description: é”™è¯¯è®°å½•æ•°
        hangzhou_records:
          type: integer
          description: æ­å·å‚è®°å½•æ•°
        ningbo_records:
          type: integer
          description: å®æ³¢å‚è®°å½•æ•°ï¼ˆåº”ä¸º0ï¼‰
        import_start_time:
          type: string
          format: date-time
          nullable: true
          description: å¯¼å…¥å¼€å§‹æ—¶é—´
        import_end_time:
          type: string
          format: date-time
          nullable: true
          description: å¯¼å…¥ç»“æŸæ—¶é—´
        error_message:
          type: string
          nullable: true
          description: é”™è¯¯æ¶ˆæ¯
        created_time:
          type: string
          format: date-time
          description: åˆ›å»ºæ—¶é—´

    # ==================== æœˆè®¡åˆ’Excelè§£æç›¸å…³æ¨¡å‹ ====================
    MonthlyParseResultRecord:
      type: object
      properties:
        row_number:
          type: integer
          description: è¡Œå·
        brand_specification:
          type: string
          description: å“ç‰Œè§„æ ¼ï¼ˆå¦‚"ä¸­åï¼ˆè½¯ï¼‰84mmæ¡ç›’"ï¼‰
        target_quantity_boxes:
          type: integer
          description: ç›®æ ‡ç®±æ•°
        machine_assignments:
          type: array
          items:
            type: string
          description: æœºå°åˆ†é…åˆ—è¡¨ï¼ˆå·åŒ…æœº+å–‚ä¸æœºï¼‰
        production_month:
          type: string
          description: ç”Ÿäº§æœˆä»½ï¼ˆå¦‚"2019-07"ï¼‰
        factory:
          type: string
          enum: [æ­å·, å®æ³¢]
          description: å·¥å‚
        planned_start:
          type: string
          format: date-time
          nullable: true
          description: è®¡åˆ’å¼€å§‹æ—¶é—´
        planned_end:
          type: string
          format: date-time
          nullable: true
          description: è®¡åˆ’ç»“æŸæ—¶é—´
        validation_status:
          type: string
          default: VALID
          description: éªŒè¯çŠ¶æ€
        validation_message:
          type: string
          nullable: true
          description: éªŒè¯ä¿¡æ¯

    ParseErrorInfo:
      type: object
      properties:
        type:
          type: string
          description: é”™è¯¯ç±»å‹
        message:
          type: string
          description: é”™è¯¯æ¶ˆæ¯
        timestamp:
          type: string
          format: date-time
          description: é”™è¯¯æ—¶é—´
      required:
        - type
        - message
        - timestamp

    MonthlyParseResult:
      type: object
      properties:
        import_batch_id:
          type: string
          description: å¯¼å…¥æ‰¹æ¬¡ID
        total_records:
          type: integer
          description: æ€»è®°å½•æ•°
        valid_records:
          type: integer
          description: æœ‰æ•ˆè®°å½•æ•°
        error_records:
          type: integer
          description: é”™è¯¯è®°å½•æ•°
        hangzhou_records:
          type: integer
          description: æ­å·å‚è®°å½•æ•°
        ningbo_records:
          type: integer
          description: å®æ³¢å‚è®°å½•æ•°ï¼ˆåº”ä¸º0ï¼‰
        records:
          type: array
          items:
            $ref: '#/components/schemas/MonthlyParseResultRecord'
          description: è§£æè®°å½•åˆ—è¡¨
        errors:
          type: array
          items:
            $ref: '#/components/schemas/ParseErrorInfo'
          description: é”™è¯¯åˆ—è¡¨
        warnings:
          type: array
          items:
            $ref: '#/components/schemas/ParseErrorInfo'
          description: è­¦å‘Šåˆ—è¡¨
        parse_time:
          type: string
          format: date-time
          description: è§£ææ—¶é—´

    MonthlyParseResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/MonthlyParseResult'

    # ==================== æœˆè®¡åˆ’è®°å½•ç›¸å…³æ¨¡å‹ ====================
    MonthlyPlanRecord:
      type: object
      properties:
        plan_id:
          type: string
          description: è®¡åˆ’ID
        brand_specification:
          type: string
          description: å“ç‰Œè§„æ ¼
        target_quantity_boxes:
          type: integer
          description: ç›®æ ‡ç®±æ•°
        machine_assignments:
          type: array
          items:
            type: string
          description: æœºå°åˆ†é…åˆ—è¡¨
        production_month:
          type: string
          description: ç”Ÿäº§æœˆä»½
        planned_start:
          type: string
          format: date-time
          nullable: true
          description: è®¡åˆ’å¼€å§‹æ—¶é—´
        planned_end:
          type: string
          format: date-time
          nullable: true
          description: è®¡åˆ’ç»“æŸæ—¶é—´
        row_number:
          type: integer
          description: è¡Œå·
        validation_status:
          type: string
          description: éªŒè¯çŠ¶æ€
        validation_message:
          type: string
          nullable: true
          description: éªŒè¯ä¿¡æ¯

    # ==================== æœˆåº¦æ’äº§ç›¸å…³æ¨¡å‹ ====================
    MonthlySchedulingRequest:
      type: object
      properties:
        import_batch_id:
          type: string
          description: å¯¼å…¥æ‰¹æ¬¡ID
        algorithm_config:
          type: object
          properties:
            efficiency_rate:
              type: number
              minimum: 0.1
              maximum: 1.0
              default: 0.85
              description: æ•ˆç‡ç³»æ•°
            maintenance_buffer_minutes:
              type: integer
              minimum: 0
              default: 30
              description: ç»´æŠ¤ç¼“å†²æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
            work_calendar_enabled:
              type: boolean
              default: true
              description: æ˜¯å¦å¯ç”¨å·¥ä½œæ—¥å†çº¦æŸ
            shift_constraint_enabled:
              type: boolean
              default: true
              description: æ˜¯å¦å¯ç”¨ç­æ¬¡çº¦æŸ
            load_balancing_enabled:
              type: boolean
              default: true
              description: æ˜¯å¦å¯ç”¨è´Ÿè½½å‡è¡¡
          description: æœˆåº¦ç®—æ³•é…ç½®å‚æ•°ï¼ˆå¯é€‰ï¼‰
      required:
        - import_batch_id

    MonthlySchedulingTaskInfo:
      type: object
      properties:
        task_id:
          type: string
          description: æœˆåº¦æ’äº§ä»»åŠ¡ID
        import_batch_id:
          type: string
          description: å¯¼å…¥æ‰¹æ¬¡ID
        status:
          type: string
          enum: [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED]
          description: ä»»åŠ¡çŠ¶æ€
        message:
          type: string
          description: çŠ¶æ€æ¶ˆæ¯

    MonthlySchedulingTaskStatus:
      type: object
      properties:
        task_id:
          type: string
          description: æœˆåº¦æ’äº§ä»»åŠ¡ID
        import_batch_id:
          type: string
          description: å¯¼å…¥æ‰¹æ¬¡ID
        task_name:
          type: string
          description: ä»»åŠ¡åç§°
        status:
          type: string
          enum: [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED]
          description: ä»»åŠ¡çŠ¶æ€
        current_stage:
          type: string
          description: å½“å‰é˜¶æ®µ
        progress:
          type: integer
          minimum: 0
          maximum: 100
          description: è¿›åº¦ç™¾åˆ†æ¯”
        total_records:
          type: integer
          nullable: true
          description: æ€»è®°å½•æ•°
        processed_records:
          type: integer
          nullable: true
          description: å·²å¤„ç†è®°å½•æ•°
        start_time:
          type: string
          format: date-time
          nullable: true
          description: å¼€å§‹æ—¶é—´
        end_time:
          type: string
          format: date-time
          nullable: true
          description: ç»“æŸæ—¶é—´
        execution_duration:
          type: number
          nullable: true
          description: æ‰§è¡Œæ—¶é•¿ï¼ˆç§’ï¼‰
        error_message:
          type: string
          nullable: true
          description: é”™è¯¯æ¶ˆæ¯
        result_summary:
          type: object
          nullable: true
          description: ç»“æœæ‘˜è¦
        algorithm_config:
          type: object
          properties:
            efficiency_rate:
              type: number
            maintenance_buffer_minutes:
              type: integer
            work_calendar_enabled:
              type: boolean
            shift_constraint_enabled:
              type: boolean
            load_balancing_enabled:
              type: boolean

    MonthlySchedulingTaskRecord:
      allOf:
        - $ref: '#/components/schemas/MonthlySchedulingTaskStatus'
        - type: object
          properties:
            created_time:
              type: string
              format: date-time
              description: åˆ›å»ºæ—¶é—´

    MonthlySchedulingTaskDetail:
      allOf:
        - $ref: '#/components/schemas/MonthlySchedulingTaskRecord'
        - type: object
          properties:
            created_by:
              type: string
              description: åˆ›å»ºäºº
            updated_time:
              type: string
              format: date-time
              description: æ›´æ–°æ—¶é—´

    ProcessingLog:
      type: object
      properties:
        id:
          type: integer
          description: æ—¥å¿—ID
        stage:
          type: string
          description: é˜¶æ®µåç§°
        step_name:
          type: string
          description: æ­¥éª¤åç§°
        level:
          type: string
          enum: [DEBUG, INFO, WARNING, ERROR]
          description: æ—¥å¿—çº§åˆ«
        message:
          type: string
          description: æ—¥å¿—æ¶ˆæ¯
        execution_time:
          type: string
          format: date-time
          description: æ‰§è¡Œæ—¶é—´
        duration_ms:
          type: integer
          nullable: true
          description: æ‰§è¡Œæ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
        processing_data:
          type: object
          nullable: true
          description: å¤„ç†æ•°æ®

    # ==================== æœˆåº¦å·¥å•ç›¸å…³æ¨¡å‹ ====================
    MonthlyWorkOrder:
      type: object
      properties:
        work_order_nr:
          type: string
          description: å·¥å•å·
        work_order_type:
          type: string
          enum: [HJB, HWS]
          description: å·¥å•ç±»å‹ï¼ˆHJB-å·åŒ…æœºï¼ŒHWS-å–‚ä¸æœºï¼‰
        machine_type:
          type: string
          description: æœºå°ç±»å‹æè¿°
        machine_code:
          type: string
          description: æœºå°ä»£ç 
        maker_code:
          type: string
          nullable: true
          description: å·åŒ…æœºä»£ç 
        feeder_code:
          type: string
          nullable: true
          description: å–‚ä¸æœºä»£ç 
        product_code:
          type: string
          description: äº§å“ä»£ç 
        brand_specification:
          type: string
          description: å“ç‰Œè§„æ ¼
        target_quantity_boxes:
          type: integer
          description: ç›®æ ‡ç®±æ•°
        work_order_status:
          type: string
          enum: [PLANNED, RUNNING, COMPLETED, PAUSED, CANCELLED]
          description: å·¥å•çŠ¶æ€
        planned_start_time:
          type: string
          format: date-time
          nullable: true
          description: è®¡åˆ’å¼€å§‹æ—¶é—´
        planned_end_time:
          type: string
          format: date-time
          nullable: true
          description: è®¡åˆ’ç»“æŸæ—¶é—´
        actual_start_time:
          type: string
          format: date-time
          nullable: true
          description: å®é™…å¼€å§‹æ—¶é—´
        actual_end_time:
          type: string
          format: date-time
          nullable: true
          description: å®é™…ç»“æŸæ—¶é—´
        created_time:
          type: string
          format: date-time
          nullable: true
          description: åˆ›å»ºæ—¶é—´
        updated_time:
          type: string
          format: date-time
          nullable: true
          description: æ›´æ–°æ—¶é—´
        task_id:
          type: string
          nullable: true
          description: å…³è”çš„æœˆåº¦æ’äº§ä»»åŠ¡ID
        sync_group_id:
          type: string
          nullable: true
          description: åŒæ­¥ç»„ID

    MonthlyWorkOrderSchedule:
      type: object
      properties:
        id:
          type: integer
          description: è®°å½•ID
        work_order_nr:
          type: string
          description: å·¥å•å·
        brand_specification:
          type: string
          description: å“ç‰Œè§„æ ¼
        target_quantity_boxes:
          type: integer
          description: ç›®æ ‡ç®±æ•°
        maker_code:
          type: string
          description: å·åŒ…æœºä»£ç 
        feeder_code:
          type: string
          description: å–‚ä¸æœºä»£ç 
        planned_start:
          type: string
          format: date-time
          nullable: true
          description: è®¡åˆ’å¼€å§‹æ—¶é—´
        planned_end:
          type: string
          format: date-time
          nullable: true
          description: è®¡åˆ’ç»“æŸæ—¶é—´
        task_id:
          type: string
          description: æœˆåº¦æ’äº§ä»»åŠ¡ID
        schedule_status:
          type: string
          enum: [PLANNED, RUNNING, COMPLETED, PAUSED, CANCELLED]
          description: æ’ç¨‹çŠ¶æ€
        sync_group_id:
          type: string
          nullable: true
          description: åŒæ­¥ç»„ID
        created_time:
          type: string
          format: date-time
          nullable: true
          description: åˆ›å»ºæ—¶é—´

    # ==================== å†å²è®°å½•ç›¸å…³æ¨¡å‹ ====================
    MonthlyPlanHistoryRecord:
      type: object
      properties:
        batch_id:
          type: string
          description: æ‰¹æ¬¡ID
        file_name:
          type: string
          description: æ–‡ä»¶å
        file_size:
          type: integer
          nullable: true
          description: æ–‡ä»¶å¤§å°
        upload_time:
          type: string
          format: date-time
          description: ä¸Šä¼ æ—¶é—´
        import_start_time:
          type: string
          format: date-time
          nullable: true
          description: å¯¼å…¥å¼€å§‹æ—¶é—´
        import_end_time:
          type: string
          format: date-time
          nullable: true
          description: å¯¼å…¥ç»“æŸæ—¶é—´
        status:
          type: string
          enum: [UPLOADING, PARSING, COMPLETED, FAILED]
          description: å¯¼å…¥çŠ¶æ€
        total_records:
          type: integer
          description: æ€»è®°å½•æ•°
        valid_records:
          type: integer
          description: æœ‰æ•ˆè®°å½•æ•°
        hangzhou_records:
          type: integer
          description: æ­å·å‚è®°å½•æ•°
        error_records:
          type: integer
          description: é”™è¯¯è®°å½•æ•°
        error_message:
          type: string
          nullable: true
          description: é”™è¯¯æ¶ˆæ¯
        task_id:
          type: string
          nullable: true
          description: å…³è”çš„æœˆåº¦æ’äº§ä»»åŠ¡ID
        scheduling_status:
          type: string
          enum: [unscheduled, scheduling, completed, failed]
          description: æœˆåº¦æ’äº§çŠ¶æ€
        scheduling_text:
          type: string
          description: æœˆåº¦æ’äº§çŠ¶æ€æè¿°
        work_orders_summary:
          type: integer
          description: å·¥å•æ•°é‡æ‘˜è¦
        can_schedule:
          type: boolean
          description: æ˜¯å¦å¯ä»¥è¿›è¡Œæœˆåº¦æ’äº§

    AvailableMonthlyBatch:
      type: object
      properties:
        batch_id:
          type: string
          description: æ‰¹æ¬¡ID
        file_name:
          type: string
          description: æ–‡ä»¶å
        total_records:
          type: integer
          description: æ€»è®°å½•æ•°
        valid_records:
          type: integer
          description: æœ‰æ•ˆè®°å½•æ•°
        hangzhou_records:
          type: integer
          description: æ­å·å‚è®°å½•æ•°
        import_end_time:
          type: string
          format: date-time
          nullable: true
          description: å¯¼å…¥å®Œæˆæ—¶é—´
        display_name:
          type: string
          description: æ˜¾ç¤ºåç§°
        can_schedule:
          type: boolean
          description: æ˜¯å¦å¯ä»¥æœˆåº¦æ’äº§

    # ==================== å·¥ä½œæ—¥å†ç›¸å…³æ¨¡å‹ ====================
    WorkCalendarEntry:
      type: object
      properties:
        calendar_date:
          type: string
          format: date
          description: æ—¥å†æ—¥æœŸ
        calendar_type:
          type: string
          enum: [WORKDAY, HOLIDAY, WEEKEND]
          description: æ—¥å†ç±»å‹
        is_working_day:
          type: boolean
          description: æ˜¯å¦å·¥ä½œæ—¥
        holiday_name:
          type: string
          nullable: true
          description: èŠ‚å‡æ—¥åç§°
        shift_config:
          type: object
          nullable: true
          description: ç­æ¬¡é…ç½®
        created_time:
          type: string
          format: date-time
          description: åˆ›å»ºæ—¶é—´

    WorkCalendarRequest:
      type: object
      properties:
        calendar_date:
          type: string
          format: date
          description: æ—¥å†æ—¥æœŸ
        calendar_type:
          type: string
          enum: [WORKDAY, HOLIDAY, WEEKEND]
          description: æ—¥å†ç±»å‹
        is_working_day:
          type: boolean
          description: æ˜¯å¦å·¥ä½œæ—¥
        holiday_name:
          type: string
          nullable: true
          description: èŠ‚å‡æ—¥åç§°
        shift_config:
          type: object
          nullable: true
          description: ç­æ¬¡é…ç½®
      required:
        - calendar_date
        - calendar_type
        - is_working_day

    # ==================== ç»Ÿè®¡ç›¸å…³æ¨¡å‹ ====================
    MonthlySystemStatistics:
      type: object
      properties:
        monthly_plans:
          type: object
          additionalProperties:
            type: integer
          description: æœˆåº¦å¯¼å…¥è®¡åˆ’ç»Ÿè®¡ï¼ˆæŒ‰çŠ¶æ€åˆ†ç»„ï¼‰
        monthly_scheduling_tasks:
          type: object
          additionalProperties:
            type: integer
          description: æœˆåº¦æ’äº§ä»»åŠ¡ç»Ÿè®¡ï¼ˆæŒ‰çŠ¶æ€åˆ†ç»„ï¼‰
        monthly_work_orders:
          type: object
          properties:
            total:
              type: integer
              description: æ€»æœˆåº¦å·¥å•æ•°
            packing_orders:
              type: integer
              description: å·åŒ…æœºå·¥å•æ•°
            feeding_orders:
              type: integer
              description: å–‚ä¸æœºå·¥å•æ•°
        timestamp:
          type: string
          format: date-time
          description: ç»Ÿè®¡æ—¶é—´

  responses:
    BadRequest:
      description: è¯·æ±‚å‚æ•°é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 400
            message: "è¯·æ±‚å‚æ•°é”™è¯¯"
            timestamp: "2024-10-16T15:30:00Z"
            status: "error"
            error_details:
              field: "import_batch_id"
              message: "å¯¼å…¥æ‰¹æ¬¡IDä¸èƒ½ä¸ºç©º"

    NotFound:
      description: èµ„æºä¸å­˜åœ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 404
            message: "èµ„æºä¸å­˜åœ¨"
            timestamp: "2024-10-16T15:30:00Z"
            status: "error"

    InternalServerError:
      description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 500
            message: "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"
            timestamp: "2024-10-16T15:30:00Z"
            status: "error"
            error_details:
              error_type: "DatabaseConnectionError"
              message: "æ•°æ®åº“è¿æ¥å¤±è´¥"

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: APIå¯†é’¥è®¤è¯
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWTä»¤ç‰Œè®¤è¯

security:
  - ApiKeyAuth: []
  - BearerAuth: []

# æ‰©å±•ä¿¡æ¯
x-tagGroups:
  - name: æœˆåº¦æ ¸å¿ƒä¸šåŠ¡æµç¨‹
    tags:
      - æœˆè®¡åˆ’æ–‡ä»¶ç®¡ç†
      - æœˆåº¦æ’äº§ç®—æ³•ç®¡ç†
      - æœˆåº¦å·¥å•ç®¡ç†
  - name: æœˆåº¦æ•°æ®ç®¡ç†
    tags:
      - æœˆåº¦æ•°æ®æŸ¥è¯¢
      - å·¥ä½œæ—¥å†ç®¡ç†

x-business-glossary:
  - term: "æœˆè®¡åˆ’"
    definition: "ä»¥æœˆä¸ºå‘¨æœŸçš„ç”Ÿäº§è®¡åˆ’ï¼Œå¤„ç†æµ™æ±Ÿä¸­çƒŸæœˆåº¦ç”Ÿäº§è®¡åˆ’å®‰æ’è¡¨"
  - term: "å“ç‰Œè§„æ ¼"
    definition: "é¦™çƒŸäº§å“çš„å®Œæ•´è§„æ ¼æè¿°ï¼Œå¦‚'ä¸­åï¼ˆè½¯ï¼‰84mmæ¡ç›’'"
  - term: "ç›®æ ‡ç®±æ•°"
    definition: "æœˆåº¦ç”Ÿäº§è®¡åˆ’ä¸­è®¾å®šçš„ç›®æ ‡äº§é‡ï¼Œä»¥ç®±ä¸ºå•ä½"
  - term: "æ­å·å‚"
    definition: "æŒ‡æ­å·å·çƒŸå‚ï¼Œè¯¥æœˆè®¡åˆ’åŠŸèƒ½ä¸“é—¨å¤„ç†æ­å·å‚çš„ç”Ÿäº§æ•°æ®"

x-conflict-avoidance:
  design_principle: "å®Œå…¨ç‹¬ç«‹çš„APIè·¯ç”±è®¾è®¡"
  existing_routes: "/plans/*ï¼ˆæ—¬è®¡åˆ’ä¸“ç”¨ï¼‰"
  new_routes: "/monthly-plans/*ï¼ˆæœˆè®¡åˆ’ä¸“ç”¨ï¼‰"
  separation_benefits:
    - "é›¶å¹²æ‰°ç°æœ‰æ—¬è®¡åˆ’åŠŸèƒ½"
    - "ç‹¬ç«‹çš„æ•°æ®æ¨¡å‹å’Œä¸šåŠ¡é€»è¾‘"
    - "ç‹¬ç«‹çš„ä»»åŠ¡é˜Ÿåˆ—å’Œè°ƒåº¦"
    - "ç‹¬ç«‹çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—"
    - "æœªæ¥å¯ç‹¬ç«‹æ‰©å±•å’Œä¼˜åŒ–"