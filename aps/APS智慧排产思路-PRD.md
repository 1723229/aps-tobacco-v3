# 目录

1. 项目目标 3
   1.1 可量化指标 3

2. 系统功能概述 4
   2.1 功能模块简介 4
      2.1.1 主数据管理 4
      2.1.2 卷包段作业任务展示 4
   2.2 排产流程概览 4
      2.2.1 卷包段排产校正 4
         2.2.1.1 输入 4
         2.2.1.2 输出 4
         2.2.1.3 功能描述 4

3. 详细解决方案 5
   3.1 生产线模型管理 5
      3.1.1 业务与需求描述 5
      3.1.2 业务逻辑与规则 5
         3.1.2.1 卷包机组生产速度定义 5
         3.1.2.2 开机班次与计划停机时间 5
   3.2 卷包旬计划录入，合并、拆分描述 6
      3.2.1 业务与需求描述 6
      3.2.2 输入输出 6
         3.2.2.1 输入- 卷包排产计划 6
         3.2.2.2 输入卷包剩余数量 7
         3.2.2.3 输出- 卷包作业任务、喂丝机工单 7
      3.2.3 业务逻辑与规则 7
         3.2.3.1 卷包机组合并、拆分原则 7
         3.2.3.2 并行原则 8
      3.2.4 用户场景与使用情景 10
         3.2.4.1 示例描述 10

4. 软件基础功能 12
   4.1 业务知识管理 12
   4.2 工作日历管理 13

5. 系统集成 14
   5.1 数据对象定义 14
      5.1.1 主数据 14
         5.1.1.1 物料主数据 14
         5.1.1.2 BOM数据 14
      5.1.2 卷包段计划及状态 14
         5.1.2.1 卷包旬计划 14
         5.1.2.2 卷包段轮保接口 14
         5.1.2.3 工单状态更新 15

# 1 项目目标

## 1.1 可量化指标

### 计划按时完工率
- 描述：即根据排产结果，成丝批次的预计完工时间早于其完工期限的比例，成丝批次的延误会导致卷包车间生产的停产。
- 计算：
  - 计划按时完工的成丝批次总重量 / 所有已排产的成丝批次总重量 X 100%
  - 目标：在制丝车间实际产能足够，并且无设备故障及其它生产意外的前提下，达到 100% 按时完工

### 均衡性
- 描述：提高产线与产线之间、班与班、天与天之间工作负荷的均衡性
- 计算：
  - 同一班时间内产线的下班时间差异
  - 同一产线班与班、天与天之间的下班时间差异

# 2 系统功能概述

## 2.1 功能模块简介

### 2.1.1 主数据管理
跟排产相关的主数据包括：设备基本信息、物料基本信息（成品烟、成品丝、叶丝、叶片、片烟、掺配物料等）、物料BOM、物料制造工艺。

知识管理模块，集中管理跟各种约束条件和业务规则，如生产加工速度等。

### 2.1.2 卷包段作业任务展示
卷包段的作业任务有用户手工录入 APS 系统，是制丝排产的重要依据。系统拆分、创建卷包作业任务展示给排产人员，以便进行制丝、作业任务的比照。

## 2.2 排产流程概览

### 2.2.1 卷包段排产校正

#### 2.2.1.1 输入
- 调度手工录入卷包旬计划，包括生产单元、牌号、投料总量、成品重量、起至时间

#### 2.2.1.2 输出
精确的卷包排产结果，具体到卷包机台、牌号、起至时间

#### 2.2.1.3 功能描述
由于卷包旬计划仅对设备轮保、机台的加工速度做粗略的考虑，因此，其结果并不能准确的反映卷包车间实际的作业计划。但卷包作业计划是制丝排产的最主要输入，其准确与否直接关系到制丝作业计划的准确性，因此，在 APS 中，首先需要在卷包旬计划的基础上，制定详细的卷包作业计划。

# 3 详细解决方案

## 3.1 生产线模型管理

### 3.1.1 业务与需求描述
卷包段的每条产线也需要在系统中进行定义，以便于查看卷包作业任务及计算烟丝消耗速度。

### 3.1.2 业务逻辑与规则

#### 3.1.2.1 卷包机组生产速度定义

| 字段说明       | 类型 | 字段 ID       |
|----------------|------|---------------|
| 卷包机型号     | 文本 | EquipmentType |
| 产品编号       | 文本 | ArticleNr     |
| 开机速度(箱/小时) | 文本 | Speed         |

以下是对应的数据表格：

| EquipmentNr | ArticleNr | Speed |
|-------------|-----------|-------|
| *           | *         | 8.0   |
| A01         | *         | 18.0  |
| A02         | *         | 18.0  |
| A03         | *         | 18.0  |
| A04         | *         | 18.0  |
| A05         | *         | 18.0  |
| B02         | *         | 11.0  |
| B07         | *         | 9.0   |
| B08         | *         | 9.0   |
| B03         | *         | 11.0  |
| C12         | *         | 3.0   |
| D02         | *         | 6.8   |
| D03         | *         | 6.8   |
| B12         | *         | 11.0  |
| A09         | *         | 7.0   |
| B04         | *         | 9.0   |
| B05         | *         | 9.0   |
| B06         | *         | 9.0   |
| D01         | *         | 7.15  |
| D04         | *         | 7.15  |
| D05         | *         | 7.15  |
| D06         | *         | 6.1   |
| B01         | *         | 11.0  |
| D07         | *         | 7.15  |
| D02         | *         | 6.8   |

**知识表1 卷包机台加工速度-FinishingSpeed**

此表格用于计算指定卷包机台在加工指定产品时候的生产速度，每个机台的主数据中都包含该机台的型号，然后根据型号及产品牌号，在上表中查找生产速度。

#### 3.1.2.2 开机班次与计划停机时间

| 字段说明       | 类型   | 字段 ID      | 示例数据  |        |
|----------------|--------|--------------|-----------|--------|
| 班次名称       | 文本   | ShiftName    | 早班      | 中班   |
| 机台名称       | 文本   | MachineName  | *         | *      |
| 开始时间       | 时间戳 | Start        | 6:40      | 15:40  |
| 结束时间       | 时间戳 | End          | 15:40     | 24:00  |
| 是否需要加班   | 布尔   | IsOTNeeded   | False     | True   |
| 最大加班时间   | 时长   | MaxOTDuration| *         | 1:00   |

**知识表2 班次定义-ShiftName**

## 3.2 卷包旬计划录入，合并、拆分描述

### 3.2.1 业务与需求描述
由于卷包旬计划仅对设备轮保、机台的加工速度做粗略的考虑，因此，其结果并不能准确的反映卷包车间实际的作业计划。但卷包作业计划的准确与否直接关系到制丝作业计划的准确性，因此，在APS中，首先需要在卷包旬计划的基础上，制定详细的卷包作业计划。

APS中的卷包段作业排产在以下方面进行更加准确的计算：
- 不同卷包机台加工不同成品烟时的速度差异
- 卷包机台的工作日历（开机班次、停机时间、轮保时间等）。卷包机台轮保时间有MES提供。

### 3.2.2 输入输出

#### 3.2.2.1 输入-卷包排产计划

| 字段说明       | 类型   | 字段 ID       |
|----------------|--------|---------------|
| 生产订单号     | 文本   | WorkOrderNr   |
| 成品烟牌号     | 文本   | ArticleNr     |
| 投料总量       | 整数   | QuantityTotal |
| 成品数量       | 整数   | FinalQuantity |
| 卷包机代码     | 文本   | MakerCode     |
| 喂丝机代码     | 文本   | FeederCode    |
| 计划开始时间   | 时间戳 | PlannedStart  |
| 计划结束时间   | 时间戳 | PlannedEnd    |

调度手工输入卷包旬计划的订单，需要给出该生产单元在加工给定定单时，包含哪些设备。

对于卷包计划要求的同时开始，同时结束，是指对于同一工单下，所有喂丝机对应的卷包机台，同时开始，同时结束。

对应同一个月的卷包旬计划。如果成品牌号、卷包机代码、喂丝机代码相同，着进行合并。

合并后的卷包工单，对应属性规则：
- 计划开始时间：前一个卷包旬计划的开始时间
- 计划结束时间：后一个卷包询计划的结束时间
- 数量：两个旬计划数量之和
- 成品数量：两个旬计划数量之和
- 喂丝机代码、卷包机组代码：旬计划对应的机组

#### 3.2.2.2 输入卷包剩余数量
喂丝机工单的剩余数量  =  计划数量－已创建批次数量
卷包机剩余数量  =  喂丝机工单的剩余数量／对应的卷包机数量。

**调研问题1：卷包任务完成情况，应根据烟丝消耗情况计算**
卷包实际生产的数量，不等于计划的烟丝数量，可能有浮动。为了保证计划的完整性，应该以烟丝为基础推算卷包的完工数量。

喂丝机工单的剩余数量  =  计划数量－已创建批次数量

#### 3.2.2.3 输出－卷包作业任务、喂丝机工单
APS将拆分的卷包工作计划，喂丝机工单导出到MES。

每个卷包机组对应一个卷包工单。卷包计划的开始结束时间，取旬计划的开始结束时间，数量平均分配。

喂丝机工单对应卷包旬计划内的所有喂丝机

对于前后月份，月份不同，牌号不同的工单，需要生成备用工单。

### 3.2.3 业务逻辑与规则

#### 3.2.3.1 卷包机组合并、拆分原则
卷包计划合并的原则：
- 旬计划在同一个月份内
- 喂丝机、卷包机组相同
- 成品牌号系统

合并后的卷包工单，对应属性规则：
- 计划开始时间：前一个卷包旬计划的开始时间
- 计划结束时间：后一个卷包询计划的结束时间
- 数量：两个旬计划数量之和
- 成品数量：两个旬计划数量之和
- 喂丝机代码、卷包机组代码：旬计划对应的机组

由于某些特殊牌号，例如利群（新版印尼）。对应的是利群（新版）的喂丝机工单。仅仅是卷包有所不同。所以对于这样的工单，仅仅创建卷包计划，下发到MES。

#### 3.2.3.2 并行原则
对于卷包计划要求的同时开始，同时结束，是指对于同一工单下，所有喂丝机对应的卷包机台，同时开始，同时结束。

![并行原则示例1](https://cdn-mineru.openxlab.org.cn/result/2025-08-15/5d09b1e8-6d69-43d2-ad48-9f8eb5352eaf/f75c5dfd520c006bd90ceda9b11f4272b65b8a02ee1425cc8ef6f9f49a1d2062.jpg)

假设对于某工单A，喂丝机1，2对应卷包机1，2，3。卷包机1开始阶段为轮保，卷包机2结束阶段为轮保。

APS可以认为3个卷包机台的开始时间为卷包机3的开始时间，结束时间为卷包机1，3调整后的时间。此时卷包机2仍在轮保。

![并行原则示例2](https://cdn-mineru.openxlab.org.cn/result/2025-08-15/5d09b1e8-6d69-43d2-ad48-9f8eb5352eaf/d38d18115924265f8e1c06a84133b4a28837b812f88ce9ff047cf57293b9d515.jpg)

假设工单A为喂丝机1，对应卷包机1。工单B为喂丝机2，对应卷包机2，3. 工单C，由喂丝机3，关联到卷包机1，2，3。

APS可以认为，对于工单C，在卷包机台2，3的开始时间，可以早于卷包机1的开始时间，无需等待。

### 3.2.4 用户场景与使用情景

#### 3.2.4.1 示例描述

**调研问题2：同一喂丝工单，可能对应多台喂丝机**
异地技改之后，对于一个喂丝工单，可能对应多台喂丝机。可以视这组喂丝机为一个虚拟喂丝机，对应的多台卷包机必须同时开始，同时结束。

卷包校正的开始时间，需要考虑卷包机对应的喂丝机，之前的喂丝任务已经结束。

物料补充，对于喂丝机工单，统一补充。

**示例数据：**

| 生产订单号 | W0001      | W0001      | W0002      | W0002      | W0003      | W0003      |
|------------|------------|------------|------------|------------|------------|------------|
| 成品烟牌号 | PA         | PA         | PA         | PA         | PA         | PA         |
| 总量       | 1260000    | 1260000    | 1260000    | 1260000    | 1260000    | 1260000    |
| 卷包机代码 | JJ#01      | JJ#02      | JJ#01      | JJ#02      | JJ#01      | JJ#02      |
| 喂丝机代码 | FF#01      | FF#01      | FF#01      | FF#01      | FF#02      | FF#02      |
| 计划开始时间 | 2010-8-31 14:00 | 2010-8-31 14:00 | 2010-8-31 17:00 | 2010-8-31 17:00 | 2010-8-31 20:00 | 2010-8-31 20:00 |
| 计划结束时间 | 2010-8-31 17:00 | 2010-8-31 17:00 | 2010-8-31 20:00 | 2010-8-31 20:00 | 2010-8-31 23:00 | 2010-8-31 23:00 |

**情况分析：**

![ERP卷包订单描述](https://cdn-mineru.openxlab.org.cn/result/2025-08-15/5d09b1e8-6d69-43d2-ad48-9f8eb5352eaf/9c5ee56e181ee3ddeb777ceee2068853b2917da09dd07c3951bf5841cb0cacdb.jpg)  
图2 ERP卷包订单描述 图3

对于工单W0001和W0002，都是喂丝机1供料，所以W0002需要等待W0001结束，才可以开始。而对于工单W0003，改为由喂丝机2供料，所以W0003，可以提前开始。

# 4 软件基础功能

## 4.1 业务知识管理
知识表中一方面包含很多基础数据，比如订单和物料信息，以及相互依赖的逻辑数据，比如说机台名称和机台速度等业务逻辑。

当业务逻辑变更时，只要在知识表中对相关的规则进行修改即可

主要信息包括：
- 设备机器产能参数定义：产能，和喂丝机关系，对应能生产的牌号
- 各工序的工时计算逻辑，包括等待时间、加工时间、冷却时间、运转时间、瓶颈保护时间等的计算规则。
- 设备的生产工艺限制，如合金限制、宽度限制、厚度限制等等
- 辅助工具的基本信息及生产特性，如轧辊的种类、数量、通过量、粗糙度，套筒的数量等。
- 工序与设备的匹配规则，依次判断每个工序可以使用的设备。
- 各优化引擎或算法的策略配置
- 其它各个功能模块需要用到的业务规则、约束条件与配置信息。

## 4.2 工作日历管理

![日历管理](https://cdn-mineru.openxlab.org.cn/result/2025-08-15/5d09b1e8-6d69-43d2-ad48-9f8eb5352eaf/784a07e2889da600c8e8822e2a066cfd76d054ce02356b7731b49e16c728a273.jpg)  
图4 日历管理

提供日历的维护与管理功能，其中包括：
- 提供换班，周末和假期等日历规则。通常这种规则会被多个机台所共享。
- 另外，也可以单独为某个机台的维护和整修时间定义异常时间。
- 日历的变更可在排产中实时可见。

如图4日历管理所示，10号退火炉定义了5月8日9点到14点这段检修时间。

# 5 系统集成

## 5.1 数据对象定义

### 5.1.1 主数据

#### 5.1.1.1 物料主数据

#### 5.1.1.2 BOM 数据

### 5.1.2 卷包段计划及状态

#### 5.1.2.1 卷包旬计划
- 数据来源：手工录入
- 触发方式：每旬更新
- 主要属性：FeedWorkOrder

**表2 卷包机工单**

| 字段说明     | 类型   | 字段 ID       |
|--------------|--------|---------------|
| 生产订单号   | 文本   | WorkOrderNr   |
| 成品烟牌号   | 文本   | ArticleNr     |
| 总量         | 整数   | QuantityTotal |
| 成品数量     | 整数   | FinalQuantity |
| 卷包机代码   | 文本   | MakerCode     |
| 计划开始时间 | 时间戳 | PlannedStart  |
| 计划结束时间 | 时间戳 | PlannedEnd    |

#### 5.1.2.2 卷包段轮保接口
- 数据来源：MES
- 触发方式：事件触发
- 主要属性：EMMaintPlan

| 结构编号 | 名称            | 描述     | 字段类型 | 字段描述                |
|----------|-----------------|----------|----------|-------------------------|
| 1        | EMIMaintPlan    |          |          |                         |
| 1.1      | MaintPlanNo     | 计划编号 | string   |                         |
| 1.2      | ScheduleTime    | 计划时间 | string   | YYYY-MM-DD              |
| 1.3      | Shift           | 班次     | string   | 1.早班 2.中班 3.晚班    |
| 1.4      | MaintGroup      | 班别     | string   | 1.甲班 2.乙班 3.丙班    |
| 1.5      | Planner         | 制单人   | string   | 直接传名字              |
| 1.6      | MaintItem       |          | string   |                         |
| 1.6.1    | EquipmentPosition | 机组   | string   | Produceline.name A1     |

#### 5.1.2.3 工单状态更新
- 数据来源：MES
- 触发方式：状态变化触发
- 接口表：PlanningStatusChange

**表3 工单状态更新**

| 字段说明   | 类型   | 字段 ID   |
|------------|--------|-----------|
| 批次号     | 文本   | BatchCode |
| 状态       | 文本   | Status    |
| 发生时间   | 时间戳 | CreateTime|
